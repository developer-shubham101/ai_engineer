<!-- Paste this into index.html (make sure to create css/styles.css and js/app.js as separate files) -->

<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Enterprise Role-Based RAG Chat UI</title>

    <!-- Bootstrap 5 CSS (CDN) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Tailwind CDN for small utilities (optional) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Local CSS -->
    <link rel="stylesheet" href="css/styles.css">

    <!-- jQuery (CDN) -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <!-- Bootstrap Bundle JS (Popper incl.) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</head>

<body>
    <!-- Header / Controls -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light px-3">
        <a class="navbar-brand mb-0 h1" href="#">RAG Chat UI</a>

        <div class="ms-auto d-flex align-items-center gap-2">
            <div class="input-group input-group-sm me-2">
                <span class="input-group-text">API Key</span>
                <input id="apiKeyInput" type="password" class="form-control" placeholder="sk-xxxx (local test key)">
                <button id="rememberKeyBtn" class="btn btn-outline-secondary" title="Remember key">ðŸ”’</button>
            </div>

            <select id="roleSelect" class="form-select form-select-sm me-2" style="width:165px;">
                <option value="Employee">Employee</option>
                <option value="Manager">Manager</option>
                <option value="HR">HR</option>
                <option value="Legal">Legal</option>
                <option value="Executive">Executive</option>
            </select>

            <div class="form-check form-switch me-2">
                <input class="form-check-input" type="checkbox" id="useLlmSwitch">
                <label class="form-check-label small-muted" for="useLlmSwitch">Use LLM</label>
            </div>

            <div class="input-group input-group-sm me-2" style="width:110px;">
                <span class="input-group-text">Top K</span>
                <input id="topKInput" type="number" min="1" max="20" value="3" class="form-control">
            </div>

            <button id="btnClearHistory" class="btn btn-outline-danger btn-sm me-1"
                title="Clear session history">Clear</button>

            <button id="btnAdminToggle" class="btn btn-outline-secondary btn-sm" data-bs-toggle="collapse"
                data-bs-target="#adminPanel">Admin</button>
        </div>
    </nav>

    <!-- Main content -->
    <div id="main" class="container-fluid">
        <div class="row g-3">
            <!-- Left: Chat -->
            <div class="col-md-8">
                <div class="card h-100">
                    <div class="card-body d-flex flex-column">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h5 class="card-title mb-0">Chat</h5>
                            <small class="text-muted" id="sessionIndicator">Session: <span
                                    id="sessionId">local</span></small>
                        </div>

                        <div class="chat-col">
                            <div id="messages" class="messages" aria-live="polite" aria-atomic="true"></div>
                        </div>

                        <!-- Composer -->
                        <div class="composer mt-3">
                            <div class="row g-2 align-items-center">
                                <div class="col">
                                    <textarea id="composerInput" class="form-control" rows="2"
                                        placeholder="Type your question..."></textarea>
                                </div>
                                <div class="col-auto d-flex flex-column align-items-end">
                                    <div class="mb-2">
                                        <button id="sendBtn" class="btn btn-primary">Send</button>
                                        <button id="attachBtn" class="btn btn-outline-secondary">Attach</button>
                                        <button id="openAddJson" class="btn btn-outline-success" data-bs-toggle="modal"
                                            data-bs-target="#addJsonModal">Add JSON</button>
                                        <button id="openUpload" class="btn btn-outline-info" data-bs-toggle="modal"
                                            data-bs-target="#uploadFileModal">Upload File</button>
                                    </div>

                                    <div class="small-muted">Top K: <span id="displayTopK">3</span> â€¢ Use LLM: <span
                                            id="displayUseLlm">off</span></div>
                                </div>
                            </div>

                            <div id="fileSelectedRow" class="file-meta-row d-none">
                                <div class="d-flex align-items-center gap-2 mt-2">
                                    <span id="selectedFilename" class="small-muted"></span>
                                    <button id="clearFileBtn" class="btn btn-sm btn-outline-danger">Remove</button>
                                </div>
                                <div class="row g-2 mt-2">
                                    <div class="col-md-4">
                                        <input id="file_department" class="form-control form-control-sm"
                                            placeholder="Department (optional)">
                                    </div>
                                    <div class="col-md-4">
                                        <select id="file_sensitivity" class="form-select form-select-sm">
                                            <option value="public">public</option>
                                            <option value="internal">internal</option>
                                            <option value="restricted">restricted</option>
                                            <option value="confidential">confidential</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <input id="file_tags" class="form-control form-control-sm"
                                            placeholder="tags,comma,separated">
                                    </div>
                                </div>
                            </div>
                        </div> <!-- composer -->
                    </div>
                </div>
            </div>

            <!-- Right: Admin & Add Docs -->
            <div class="col-md-4">
                <div class="collapse" id="adminPanel">
                    <div class="card admin-panel mb-3">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h6 class="mb-0">Admin Panel</h6>
                            <small class="text-muted">role-sensitive controls</small>
                        </div>
                        <div class="card-body">
                            <div class="d-grid gap-2 mb-3">
                                <button id="btnFetchAccessRequests" class="btn btn-outline-primary">Fetch Access
                                    Requests</button>
                                <button id="btnShowAccessRequestsLocal" class="btn btn-outline-secondary">Show Local
                                    Requests</button>
                                <button id="btnUpdateMetadata" class="btn btn-outline-warning" data-bs-toggle="modal"
                                    data-bs-target="#updateMetadataModal">Update Metadata</button>
                            </div>

                            <div id="accessRequestsList" class="list-group"></div>
                        </div>
                    </div>
                </div>

                <div class="card mb-3">
                    <div class="card-header">
                        <h6 class="mb-0">Add Document</h6>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-sm btn-success w-100 mb-2" data-bs-toggle="modal"
                            data-bs-target="#addJsonModal">Add JSON Doc</button>
                        <button class="btn btn-sm btn-info w-100" data-bs-toggle="modal"
                            data-bs-target="#uploadFileModal">Upload File</button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h6 class="mb-0">Session</h6>
                    </div>
                    <div class="card-body small-muted">
                        <div>Messages: <span id="msgCount">0</span></div>
                        <div>Last activity: <span id="lastActivity">-</span></div>
                        <div class="mt-2">
                            <label><input id="rememberKeyCheckbox" type="checkbox"> Remember key in localStorage</label>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- (same modal markup as single-file version) -->
    <!-- Add JSON Modal -->
    <div class="modal fade" id="addJsonModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <form id="addJsonForm">
                    <div class="modal-header">
                        <h5 class="modal-title">Add JSON Document</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-2">
                            <label class="form-label">Source Name</label>
                            <input id="json_source_name" class="form-control" required>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Text</label>
                            <textarea id="json_text" class="form-control" rows="6" required></textarea>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Metadata (JSON)</label>
                            <textarea id="json_metadata" class="form-control" rows="4"
                                placeholder='{"department":"HR","sensitivity":"internal"}'></textarea>
                        </div>
                        <div id="addJsonResponse" class="mt-2"></div>
                    </div>
                    <div class="modal-footer">
                        <button id="btnAddJson" type="submit" class="btn btn-primary">Add</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Upload File Modal -->
    <div class="modal fade" id="uploadFileModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form id="uploadFileForm" enctype="multipart/form-data">
                    <div class="modal-header">
                        <h5 class="modal-title">Upload File</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-2">
                            <label class="form-label">Select File</label>
                            <input id="upload_file_input" type="file" class="form-control" required>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Department</label>
                            <input id="upload_department" class="form-control">
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Sensitivity</label>
                            <select id="upload_sensitivity" class="form-select">
                                <option value="public">public</option>
                                <option value="internal">internal</option>
                                <option value="restricted">restricted</option>
                                <option value="confidential">confidential</option>
                            </select>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Tags (comma separated)</label>
                            <input id="upload_tags" class="form-control">
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Public Summary</label>
                            <textarea id="upload_public_summary" class="form-control" rows="3"></textarea>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Owner ID</label>
                            <input id="upload_owner_id" class="form-control">
                        </div>

                        <div id="uploadResponse" class="mt-2"></div>
                    </div>
                    <div class="modal-footer">
                        <button id="btnUploadFile" type="submit" class="btn btn-primary">Upload</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Update Metadata Modal -->
    <div class="modal fade" id="updateMetadataModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <form id="updateMetadataForm">
                    <div class="modal-header">
                        <h5 class="modal-title">Update Metadata</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-2">
                            <label>Chunk IDs (JSON array)</label>
                            <textarea id="update_ids" class="form-control" rows="3"
                                placeholder='["id1","id2"]'></textarea>
                        </div>
                        <div class="mb-2">
                            <label>Metadata (JSON)</label>
                            <textarea id="update_metadata" class="form-control" rows="4"
                                placeholder='{"sensitivity":"internal"}'></textarea>
                        </div>
                        <div id="updateMetadataResponse" class="mt-2"></div>
                    </div>
                    <div class="modal-footer">
                        <button id="btnUpdateMetadataSubmit" type="submit" class="btn btn-warning">Update</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Request Access Modal -->
    <div class="modal fade" id="requestAccessModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form id="requestAccessForm">
                    <div class="modal-header">
                        <h5 class="modal-title">Request Access</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" id="request_doc_id">
                        <div class="mb-2">
                            <label class="form-label">Reason</label>
                            <textarea id="request_reason" class="form-control" rows="3" required></textarea>
                        </div>
                        <div id="requestAccessResponse" class="mt-2"></div>
                    </div>
                    <div class="modal-footer">
                        <button id="btnSubmitRequestAccess" type="submit" class="btn btn-primary">Request</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Toast container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- App JS -->
    <script src="js/app.js"></script>
</body>

</html>

<!-- End of index.html -->